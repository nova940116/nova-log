---
title: vercel/og를 이용해 초간단 썸네일 생성기 만들기(with Next.js)
description: 오픈그래프 이미지 생성을 지원하는 @vercel/og를 응용해 썸네일 생성 서비스를 만들어보자
image: /images/blog/blog-post-3.jpg
date: "2023-11-15"
---

Vercel에서 제공하는 오픈그래프 생성 라이브러리인 `@vercel/og` 라는게 있습니다. 블로그를 포스팅 할 때 og image를 자동으로 생성하는 용도로 주로 쓰이는 것 같습니다만
이를 응용하면 썸네일 생성 서비스를 쉽게 만들 수 있습니다.

## 결과물 미리보기
[https://thumbnail-maker.vercel.app/](https://thumbnail-maker.vercel.app)   
썸네일을 생성하고 png 파일로 다운로드 받을 수 있습니다.

## 서비스 컨셉

제가 세운 계획은 아주 단순합니다. 메인 페이지에 진입하면, default로 정의된 값들로 썸네일을 생성하고, 이를 preview로 보여줍니다.
사용자는 원하는 제목, 이름, 색상, 비율 등을 선택하고, 각각의 이벤트마다 변경된 내용을 preview에 반영합니다.
썸네일을 완성한후에 다운로드 버튼을 클릭해 썸네일을 다운로드 받습니다.

--- 여기 mp4 ---

## 메인화면 UI 및 API 호출하기

```tsx app/page.tsx
"use client"
import { useEffect, useRef, useState } from 'react'
import { useDebounce } from "@/hooks/useDebounce"
import Image from 'next/image'
import Link from 'next/link'

export default function Home() {
  const [width, setWidth] = useState<number>(600)
  const [height, setHeight] = useState<number>(300)
  const [title, setTitle] = useState<string>("쉽고 편하게.             썸네일 만들기 😀")
  const [name, setName] = useState<string>("@썸네일메이커")
  const [ratio, setRatio] = useState<string>("4:3")
  const [backgroundColor, setBackgroundColor] = useState<string>("#427BFF")
  const [textColor, setTextColor] = useState<string>("#000")
  const [imageSrc, setImageSrc] = useState<string>("")
  const backgroundColorRef = useRef<HTMLInputElement>(null)
  const colorRef = useRef<HTMLInputElement>(null)
  const debouncedTitleTerm: string = useDebounce<string>(title, 300)
  const debouncedNameTerm: string = useDebounce<string>(name, 300)  

  const loadImage = async () => {
    setWidth(width)
    setHeight(height)
    const data = await fetch(`/og?ratio=${ratio}&title=${title}&name=${name}&backgroundColor=${backgroundColor.replace('#', '')}
      &textColor=${textColor.replace('#', '')}`)
    const file = await data.blob()  
    setImageSrc(URL.createObjectURL(file))
  }

  const downloadThumbnail = async() => {
    const data = await fetch(`/og?ratio=${ratio}&title=${title}&name=${name}&backgroundColor=${backgroundColor.replace('#', '')}
      &textColor=${textColor.replace('#', '')}`)
    const file = await data.blob()
    const url = URL.createObjectURL(file)
    const a = document.createElement("a")
    a.setAttribute("download", 'thumbnail.png')
    a.setAttribute("href", url)
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
  }

  // eslint-disable-next-line react-hooks/exhaustive-deps
  useEffect(() => { loadImage() }, [backgroundColor, textColor, ratio, debouncedTitleTerm, debouncedNameTerm])

  return (
    <main className="m-auto min-h-screen max-w-[50rem] flex flex-col">
      <section>
        <div className='border-x-2 border-b-2 border-black flex justify-center bg-black h-[300px]'>
          { imageSrc ? 
          <Image className='max-w-full max-h-full object-contain' src={imageSrc} alt="thumbnail" width={width} height={height} /> 
          : null }     
        </div>
        <table className='w-full'>
          <thead></thead>
          <tbody>
            <tr className='border-b-2 border-x-2 border-black h-[70px]'>
              <td className='w-1/4 border-r-2 border-black text-center font-bold text-lg'>비율</td>
              <td className={`${ratio === '4:3' ? 'bg-pink-300 text-white' : '' } w-1/4 border-r-2 border-black text-center cursor-pointer`} onClick={() => setRatio('4:3')}>
                4:3
              </td>
              <td className={`${ratio === '2:1' ? 'bg-pink-300 text-white' : '' } w-1/4 border-r-2 border-black text-center cursor-pointer`} onClick={() => setRatio('2:1')}>
                2:1
              </td>
              <td className={`${ratio === '1:1' ? 'bg-pink-300 text-white' : '' } w-1/4 border-r-2 border-black text-center cursor-pointer`} onClick={() => setRatio('1:1')}>
                1:1
              </td>
            </tr>
            <tr className='border-b-2 border-x-2 border-black h-[70px]'>
              <td className='w-1/4 border-r-2 border-black text-center font-bold text-lg'>제목</td>
              <td className='border-r-2 border-black text-center' colSpan={3}>
                <input className='w-full h-[70px] px-4 outline-none' value={title} onChange={(event) => setTitle(event.target.value)} />
              </td>
            </tr>
            <tr className='border-b-2 border-x-2 border-black h-[70px]'>
              <td className='w-1/4 border-r-2 border-black text-center font-bold text-lg'>이름</td>
              <td className='border-r-2 border-black text-center' colSpan={3}>
                <input className='w-full h-[70px] px-4 outline-none' value={name} onChange={(event) => setName(event.target.value)} />
              </td>
            </tr>
            <tr className='border-b-2 border-x-2 border-black h-[70px]'>
              <td className='w-1/4 border-r-2 border-black text-center font-bold text-lg'>배경색</td>
              <td className='border-r-2 border-black text-center' style={{ backgroundColor: `${backgroundColor}` }}>
                <div className={`w-full h-[70px] bg-[${backgroundColor}]`} onClick={() => backgroundColorRef.current?.click()}></div>
                <input type="color" className='h-0 w-0 absolute' value={backgroundColor} onChange={(event) => setBackgroundColor(event.target.value)} ref={backgroundColorRef} />
              </td>
              <td className='w-1/4 border-r-2 border-black text-center font-bold text-lg'>글자색</td>
              <td className='border-r-2 border-black text-center' style={{ backgroundColor: `${textColor}` }}>
                <div className={`w-full h-[70px] bg-[${textColor}]`} onClick={() => colorRef.current?.click()}></div>
                <input type="color" className='h-0 w-0 absolute' value={textColor} onChange={(event) => setTextColor(event.target.value)} ref={colorRef} />
              </td>
            </tr>
            <tr className='border-b-2 border-x-2 border-black h-[75px]'>
              <td 
                className='text-center font-black bg-orange-300 text-white text-xl cursor-pointer hover:bg-gray-400' 
                style={{ WebkitTextStroke: '1px black' }}
                colSpan={4} 
                onClick={downloadThumbnail}>이미지 다운로드(PNG)</td>
            </tr>
          </tbody>
        </table>
      </section>
    </main>
  )
}
```
최초 진입시 및 썸네일의 비율, 제목, 이름, 색상등을 입력받고 변경 될 시 `loadImage` 함수를 호출합니다. `loadImage` 함수 내부에선 og image를 응답 받는 api를 호출
하여 image를 응답 받고, `setImageUrl` 훅을 호출해 변경된 썸네일 이미지를 보여줍니다. 제목과 이름의 경우엔 debounce를 걸어잦은 api 호출을 방지해둡니다.

--- 여기 page.tsx UI 이미지 ---


## OG Image Response API 만들기

```tsx app/og/route.tsx
import { ImageResponse } from 'next/server'
 
export const runtime = 'edge'
 
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url)
  const ratio = searchParams.get('ratio')
  const title = searchParams.get('title')
  const name = searchParams.get('name')
  const backgroundColor = searchParams.get('backgroundColor')
  const textColor = searchParams.get('textColor')

  const fontData = await fetch(
    new URL('@/public/SpoqaHanSansNeo-Bold.woff', import.meta.url),
  ).then((res) => res.arrayBuffer())  

  let width = 600
  let height = 300
  if (ratio === '4:3') {
    width = 600
    height = 450
  }
  if (ratio === '2:1') {
    width = 600
    height = 300
  }
  if (ratio === '1:1') {
    width = 600
    height = 600
  }

  return new ImageResponse(
    (
      <div 
        tw={`h-full w-full flex justify-center`} 
        style={{ alignItems: 'center', backgroundColor: `#${backgroundColor}`, color: `#${textColor}`, fontFamily: 'SpoqaHanSansNeo' }}
      >
        <div tw="flex absolute left-[24px] top-[24px]">
          <span>{name}</span>
        </div>        
        <h1 tw="flex justify-center text-6xl leading-normal" style={{ whiteSpace: 'pre-wrap', padding: '40px' }}>{title}</h1>
      </div>
    ),
    {
      width: width,
      height: height,
      fonts: [
        {
          name: 'SpoqaHanSansNeo',
          data: fontData,
          style: 'normal',
        },
      ],      
    },
  )
}
```
`@vercel/og`는 Next.js 13의 App Router를 사용한다면 따로 설치하지 않아도 사용이 가능합니다.
