---
title: Next.js 13으로 프로덕션 개발하기(feat. 널위한물결)
summary: Server Component, App Router, Google Fonts... 처음엔 마냥 좋을줄만 알았던 Next.js 13 버전 개발기
date: '2023-09-24'
---

처음 Next.js 13 버전이 공개되고 변경 점 들을 살펴보고 놀라움을 금치 못했다. App Router, Server Component, Google Fonts 지원 등등...
바로 이해가 되지 않는 개념들도 있었지만 계속해서 관련 포스트를 찾아보고 공식문서를 확인하다보니 프로덕션 레벨에 사용해보고 싶은 마음이 들었다.

## 부담없이 적용 해볼까?

마침 국내 웹사이트들을 모아서 소개하는 프로덕트가 있었으면 좋겠다는 생각을 하고있던 참이여서, 이 프로덕트를 개발할때 Next.js 13 버전을 적용해보기로 했다.
프로덕트 구조 자체는 단순하다. 사이트 제목, 링크, 이미지등을 데이터베이스에 저장해놓고 불러오기만 하면 되는, 복잡한 기능이 들어가지 않기 때문에
더더욱 최신버전의 Next.js를 적용하기에 무리가 없다고 생각했다.

## 서버사이드 렌더링(SSR) 과 Pagination

이번 프로덕트를 개발하면서 SSR또한 처음 적용해보았다. 기존엔 사이드 프로젝트나 실무에서나 CSR을 사용하는게 너무 당연했었는데,
아무래도 SSR의 장점이 더욱 크다는게 공부하면서 배우게 된 것도 있고, 이번에 적용하면서도 어느정도 체감하게 되었다. SSR환경에서 
Pagination을 구현하려고 보니 url에 querystring을 붙이고, searchParams를 이용해야 했다.

```tsx
// URL: https://example.com?page=2

export default function Page({ searchParams }: { searchParams?: { [key: string]: string | string[] | undefined }) {
  const currentPage: number = Number(searchParams?.page)
  console.log(currentPage) // result: 2
}
```
처음 SSR을 써봐서 이런 pagination 방식이 너무 오랜만에 느껴졌다. 처음 개발을 `PHP`로 시작할 때 가 생각났다.

## 체감했던 SSR의 장점

확실히 SSR을 적용해보니 몇가지 장점이 확 체감되었다. 보안에 덜 신경써도 된다. SEO에 좋다는건 뭐 잘 알려진 장점이니 패스, React의 불편한 상태관리를 덜 하거나 아예 하지않아도 된다.
`useState`와 `useEffect`를 사용하며 사이드이펙트에 고통받았던 지난날들을 생각하면 이는 엄청난 장점인것같다.

## 배포후 발생한 문제: Caching 유무에 따른 급격한 성능 차이 발생

개발과정에서는 전혀 느낄수 없었던 문제가 프로덕션에 배포후 발생했다. Vercel에 프로덕트를 배포하고나서, Page Load Time이 너무 길어지는 현상이 발생했다.

```ts:app/page.tsx
export const revalidate = 0 // ❌
export const revalidate = 60 // ✅

...
```
기본적으로 Next.js 13버전에서는 서버에서 발생하는 fetch request를 캐싱하도록 되어있다. 따라서, 데이터베이스에 데이터가 추가되더라도
추가된 정보가 화면에 바로 반영되지 않는다. 캐싱을 하고싶지 않다면 위의코드와 같이 revalidate time을 0으로 주면된다. 하지만 캐싱이
되냐 안되냐에 따라서 page load time이 급격하게 차이가났다. 캐싱을 하지 않으면 SSR을 거의 사용할수 없는 수준이었다. 이게 Next.js 13
버전에서만 발생하는 문제인지는 모르겠으나(이전 버전의 Next.js를 사용해본적이 없기에), 어쨌든 현재로써는 캐싱은 필수인것 같다. 


## 결과

![널위한물결](/site.png)
어쨌든 ~~성공적으로~~ 프로덕트를 런칭했다. 프로덕트 명은 `널위한물결` 이다. 다양한 국내 웹 사이트를 간결하게 소개하는것이 목적이다.
[여기](https://foryouwave.com)에서 사이트를 확인 할 수 있다. 

## 회고

글로는 프로덕트를 개발하는 과정을 함축적으로 썼지만, 사실 삽질을 많이했다. 프로덕션에서 SSR의 page load time이 너무 느려서 도중에
CSR로 전환을 시켰다가(당시에는 왜 이런 문제가 발생하는지에 대한 원인을 찾지못했다..), 다시 SSR로 바꾸는 등. 

프로덕트를 구현하면서 바뀐 Next.js에 대해 좀 더 깊게 알아 볼 수 있어 좋았고, 신기술이 마냥 좋기만한건 아니라는 것도 알게 되었다. 
폰트를 `<link rel... />`같은 방식으로 로드 할 수 없는것도 좀 불편했다. 아무래도 나 같은 경우에는 정말 심플하게 프로덕션 환경을 구성했기에
문제가 덜하다고 생각한다. 규모가 좀 있는 경우에는 프로덕션에 적용하려면 고려해야 할 것이 좀 더 많지 않을까.
